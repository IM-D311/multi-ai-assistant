<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-AI Assistant | ChatGPT + DeepSeek + Gemini</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: #f8fafc;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            width: 100%;
        }

        header {
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid #334155;
            padding: 20px 0;
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 24px;
            font-weight: 700;
            color: #60a5fa;
        }

        .logo i {
            color: #3b82f6;
        }

        .ai-selector {
            display: flex;
            gap: 10px;
        }

        .ai-btn {
            background: #1e293b;
            border: 1px solid #334155;
            color: #cbd5e1;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .ai-btn:hover {
            background: #334155;
        }

        .ai-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }

        .api-config-btn {
            background: transparent;
            border: 1px solid #60a5fa;
            color: #60a5fa;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-left: 10px;
        }

        .api-config-btn:hover {
            background: rgba(96, 165, 250, 0.1);
        }

        main {
            flex: 1;
            padding: 30px 0;
        }

        .chat-container {
            display: flex;
            flex-direction: column;
            height: 70vh;
            max-height: 70vh;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #334155;
            backdrop-filter: blur(10px);
            margin-bottom: 30px;
        }

        .chat-header {
            padding: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid #334155;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .ai-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .ai-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .chatgpt-icon {
            background: #10a37f;
        }

        .deepseek-icon {
            background: #4f46e5;
        }

        .gemini-icon {
            background: #ea4335;
        }

        .ai-name {
            font-weight: 600;
            font-size: 18px;
        }

        .ai-description {
            color: #94a3b8;
            font-size: 14px;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            display: flex;
            gap: 12px;
            max-width: 85%;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            margin-top: 5px;
        }

        .user-avatar {
            background: #3b82f6;
        }

        .ai-avatar {
            background: #475569;
        }

        .message-content {
            background: #1e293b;
            padding: 15px;
            border-radius: 16px;
            border: 1px solid #334155;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .user-message .message-content {
            background: #1d4ed8;
            border-color: #3b82f6;
        }

        .message-text {
            color: #f1f5f9;
        }

        .message-text a {
            color: #60a5fa;
            text-decoration: none;
        }

        .message-text a:hover {
            text-decoration: underline;
        }

        .message-text pre {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 10px 0;
            border-left: 4px solid #3b82f6;
        }

        .message-text code {
            background: rgba(0, 0, 0, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
        }

        .message-text pre code {
            background: none;
            padding: 0;
        }

        .message-time {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 8px;
            text-align: right;
        }

        .chat-input-container {
            padding: 20px;
            background: rgba(15, 23, 42, 0.9);
            border-top: 1px solid #334155;
        }

        .input-wrapper {
            display: flex;
            gap: 10px;
        }

        #userInput {
            flex: 1;
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 15px;
            color: #f1f5f9;
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            resize: none;
            min-height: 56px;
            max-height: 120px;
        }

        #userInput:focus {
            outline: none;
            border-color: #3b82f6;
        }

        #sendBtn {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 12px;
            width: 56px;
            height: 56px;
            cursor: pointer;
            font-size: 18px;
            transition: background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #sendBtn:hover {
            background: #2563eb;
        }

        #sendBtn:disabled {
            background: #475569;
            cursor: not-allowed;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .feature-card {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 12px;
            padding: 25px;
            border: 1px solid #334155;
            transition: transform 0.3s ease, border-color 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            border-color: #3b82f6;
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-bottom: 15px;
        }

        .feature-card:nth-child(1) .feature-icon {
            background: rgba(16, 163, 127, 0.2);
            color: #10a37f;
        }

        .feature-card:nth-child(2) .feature-icon {
            background: rgba(79, 70, 229, 0.2);
            color: #8b5cf6;
        }

        .feature-card:nth-child(3) .feature-icon {
            background: rgba(234, 67, 53, 0.2);
            color: #ea4335;
        }

        .feature-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .feature-desc {
            color: #94a3b8;
            font-size: 14px;
        }

        footer {
            background: rgba(15, 23, 42, 0.9);
            border-top: 1px solid #334155;
            padding: 20px 0;
            text-align: center;
            color: #94a3b8;
            font-size: 14px;
        }

        .api-key-setup {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            font-size: 14px;
        }

        .loading {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #94a3b8;
        }

        .loading-dots {
            display: flex;
            gap: 4px;
        }

        .loading-dots span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #3b82f6;
            animation: bounce 1.4s infinite ease-in-out both;
        }

        .loading-dots span:nth-child(1) { animation-delay: -0.32s; }
        .loading-dots span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 15px;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #94a3b8;
            animation: typing 1.5s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) { animation-delay: -0.3s; }
        .typing-dot:nth-child(2) { animation-delay: -0.15s; }
        .typing-dot:nth-child(3) { animation-delay: 0s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid #3b82f6;
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            color: #f1f5f9;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            color: #60a5fa;
        }

        .api-input-group {
            margin: 20px 0;
        }

        .api-input-group label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .api-input-group input {
            width: 100%;
            padding: 12px;
            background: #1e293b;
            border: 1px solid #475569;
            border-radius: 8px;
            color: white;
            font-family: 'Poppins', sans-serif;
            margin-bottom: 5px;
        }

        .api-input-group .key-status {
            font-size: 12px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .api-input-group .key-status.valid {
            color: #10a37f;
        }

        .api-input-group .key-status.invalid {
            color: #ef4444;
        }

        .api-input-group a {
            display: inline-block;
            margin-top: 5px;
            color: #60a5fa;
            font-size: 14px;
            text-decoration: none;
        }

        .api-input-group a:hover {
            text-decoration: underline;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 25px;
        }

        .primary-btn {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .primary-btn:hover {
            background: #2563eb;
        }

        .secondary-btn {
            background: #475569;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            flex: 1;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            transition: background 0.3s ease;
        }

        .secondary-btn:hover {
            background: #64748b;
        }

        .note {
            margin-top: 15px;
            font-size: 12px;
            color: #94a3b8;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #10a37f;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            animation: slideIn 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .notification.error {
            background: #ef4444;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .api-mode-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            color: #94a3b8;
        }

        .api-mode-indicator.active {
            color: #10a37f;
        }

        .api-mode-indicator.inactive {
            color: #ef4444;
        }

        /* Remember Me Checkbox Styles */
        .remember-me {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 15px 0;
            padding: 10px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 8px;
        }

        .remember-me input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #3b82f6;
        }

        .remember-me label {
            cursor: pointer;
            user-select: none;
            color: #cbd5e1;
            font-size: 14px;
        }

        .remember-me i {
            color: #60a5fa;
        }

        @media (max-width: 768px) {
            .ai-selector {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .chat-container {
                height: 60vh;
            }
            
            .message {
                max-width: 95%;
            }
            
            .features {
                grid-template-columns: 1fr;
            }
            
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            .api-config-btn {
                margin-left: 0;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal (Always shows first) -->
    <div id="loginModal" class="modal active">
        <div class="modal-content" style="max-width: 400px;">
            <h2><i class="fas fa-sign-in-alt"></i> Multi-AI Assistant</h2>
            <p>Login to access AI capabilities</p>
            
            <div class="api-input-group">
                <label for="loginEmail">
                    <i class="fas fa-envelope"></i> Email Address
                </label>
                <input type="email" id="loginEmail" placeholder="your@email.com">
            </div>
            
            <div class="api-input-group">
                <label for="loginPassword">
                    <i class="fas fa-lock"></i> Password
                </label>
                <input type="password" id="loginPassword" placeholder="••••••••">
            </div>
            
            <!-- Remember Me Checkbox -->
            <div class="remember-me">
                <input type="checkbox" id="rememberMe">
                <label for="rememberMe">
                    <i class="fas fa-check-circle"></i> Remember Me for 30 days
                </label>
            </div>
            
            <div id="loginError" style="color: #ef4444; font-size: 14px; margin: 10px 0; display: none;">
                <i class="fas fa-exclamation-circle"></i> Invalid email or password
            </div>
            
            <div class="modal-buttons">
                <button id="loginBtn" class="primary-btn">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
            </div>
            
            <p class="note">
                <i class="fas fa-info-circle"></i> 
                Public users can use the assistant. Admin login required for API settings.
            </p>
        </div>
    </div>

    <!-- API Configuration Modal (Only for admin) -->
    <div id="apiConfigModal" class="modal">
        <div class="modal-content">
            <h2><i class="fas fa-key"></i> Admin API Configuration</h2>
            <p>Only admin can configure API keys</p>
            
            <div class="api-input-group">
                <label>
                    <i class="fab fa-openai"></i> OpenAI API Key
                </label>
                <div class="key-status" id="openaiStatus">
                    <i class="fas fa-question-circle"></i> Checking...
                </div>
            </div>
            
            <div class="api-input-group">
                <label>
                    <i class="fas fa-code"></i> DeepSeek API Key
                </label>
                <div class="key-status" id="deepseekStatus">
                    <i class="fas fa-question-circle"></i> Checking...
                </div>
            </div>
            
            <div class="api-input-group">
                <label>
                    <i class="fab fa-google"></i> Gemini API Key
                </label>
                <div class="key-status" id="geminiStatus">
                    <i class="fas fa-question-circle"></i> Checking...
                </div>
            </div>
            
            <div class="modal-buttons">
                <button id="closeModal" class="secondary-btn">
                    Close
                </button>
            </div>
            
            <p class="note">
                <i class="fas fa-user-shield"></i> 
                Only admin (imulla311@gmail.com) can access these settings.
            </p>
        </div>
    </div>

    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-robot"></i>
                    <span id="siteTitle">Multi-AI Assistant</span>
                </div>
                <div style="display: flex; align-items: center; gap: 15px;">
                    <div class="ai-selector">
                        <button class="ai-btn active" data-ai="auto">
                            <i class="fas fa-magic"></i> Auto Select
                        </button>
                        <button class="ai-btn" data-ai="chatgpt">
                            <i class="fas fa-comment"></i> ChatGPT
                        </button>
                        <button class="ai-btn" data-ai="deepseek">
                            <i class="fas fa-code"></i> DeepSeek
                        </button>
                        <button class="ai-btn" data-ai="gemini">
                            <i class="fas fa-image"></i> Gemini
                        </button>
                    </div>
                    <button id="openApiConfig" class="api-config-btn" style="display: none;">
                        <i class="fas fa-key"></i> Admin Settings
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div class="chat-container">
            <div class="chat-header">
                <div class="ai-info">
                    <div class="ai-icon chatgpt-icon">
                        <i class="fas fa-magic"></i>
                    </div>
                    <div>
                        <div class="ai-name">Auto AI Selector</div>
                        <div class="ai-description">Login to access real AI capabilities</div>
                    </div>
                </div>
                <div class="loading" id="statusIndicator">
                    <i class="fas fa-circle" style="color: #ef4444;"></i>
                    <span id="statusText">Not Logged In</span>
                    <span id="apiMode" class="api-mode-indicator inactive">
                        <i class="fas fa-plug"></i> Login Required
                    </span>
                </div>
            </div>
            
            <div class="chat-messages" id="chatMessages">
                <div class="message">
                    <div class="avatar ai-avatar">
                        <i class="fas fa-robot"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-text">
                            <strong>Welcome to Multi-AI Assistant!</strong><br><br>
                            Please login to use the AI assistant. All users share the same AI capabilities.<br><br>
                            • <strong>ChatGPT</strong> for reasoning, writing, creative tasks<br>
                            • <strong>DeepSeek</strong> for coding, math, technical queries<br>
                            • <strong>Gemini</strong> for images, vision, multimodal tasks<br><br>
                            <em>Admin login required for API configuration.</em>
                        </div>
                        <div class="message-time">Just now</div>
                    </div>
                </div>
            </div>
            
            <div class="chat-input-container">
                <div class="input-wrapper">
                    <textarea id="userInput" placeholder="Please login to use the AI assistant..." rows="1" disabled></textarea>
                    <button id="sendBtn" disabled>
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
                <div class="api-key-setup">
                    <strong><i class="fas fa-user"></i> Status:</strong> 
                    <span id="apiStatusText">Please login to use the assistant</span>
                    <button id="quickLogin" style="margin-left: 10px; padding: 4px 8px; background: transparent; border: 1px solid #60a5fa; color: #60a5fa; border-radius: 4px; cursor: pointer;">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </div>
            </div>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-comment-dots"></i>
                </div>
                <h3 class="feature-title">ChatGPT</h3>
                <p class="feature-desc">Best for reasoning, creative writing, brainstorming, and general conversation. Uses GPT-4 technology for nuanced understanding and human-like responses.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-code"></i>
                </div>
                <h3 class="feature-title">DeepSeek</h3>
                <p class="feature-desc">Specialized for coding, mathematics, technical problem-solving, and logical reasoning. Excellent for debugging, algorithm design, and data analysis.</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-image"></i>
                </div>
                <h3 class="feature-title">Gemini</h3>
                <p class="feature-desc">Optimized for image analysis, multimodal tasks, visual understanding, and Google ecosystem integration. Great for content generation with visual context.</p>
            </div>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>Multi-AI Assistant | ChatGPT + DeepSeek + Gemini | Public Access</p>
            <p style="font-size: 12px; margin-top: 5px;">
                <i class="fas fa-user-shield"></i> Admin: imulla311@gmail.com
            </p>
        </div>
    </footer>

    <script>
        // ========== ADMIN CREDENTIALS ==========
        const ADMIN_EMAIL = "imulla311@gmail.com";
        const ADMIN_PASSWORD = "Imulla@311";
        
        // ========== REMEMBER ME SETTINGS ==========
        const REMEMBER_DAYS = 30; // Remember for 30 days
        
        // ========== BASE64 ENCODED API KEYS ==========
        // !!! IMPORTANT: ENCODE YOUR OWN API KEYS !!!
        // Step 1: Get your API keys from:
        // - OpenAI: platform.openai.com/api-keys
        // - DeepSeek: platform.deepseek.com/api_keys
        // - Gemini: makersuite.google.com/app/apikey
        
        // Step 2: Encode each key to Base64 by opening browser console (F12)
        // and running: btoa("your-api-key-here")
        // Example: btoa("sk-abc123...") gives "c2stYWJjMTIz..."
        
        // Step 3: Paste the encoded strings below:
        const ENCODED_API_KEYS = {
            // Replace with your Base64 encoded OpenAI API key
            openai: "4753810923476a08a299fb15c91f7806e36741bfd0523237af90f048a1a4232b",
            
            // Replace with your Base64 encoded DeepSeek API key
            deepseek: "050d1ed04b61475b087b0c635d45d2609540d9ed8e361956fb575877cfe389a5",
            
            // Replace with your Base64 encoded Gemini API key
            gemini: "0a785521b783a5f4ce58ab6520a78ed399f369bcd0a3ba8b144c2df75314acc0"
        };
        
        // Decoded API Keys (will be populated on load)
        let ADMIN_API_KEYS = {
            openai: "",
            deepseek: "",
            gemini: ""
        };
        
        // Function to decode Base64 API keys
        function decodeAPIKeys() {
            try {
                ADMIN_API_KEYS.openai = atob(ENCODED_API_KEYS.openai);
                ADMIN_API_KEYS.deepseek = atob(ENCODED_API_KEYS.deepseek);
                ADMIN_API_KEYS.gemini = atob(ENCODED_API_KEYS.gemini);
                
                console.log('API keys decoded successfully');
                return true;
            } catch (error) {
                console.error('Error decoding API keys:', error);
                // Fallback to demo mode if decoding fails
                ADMIN_API_KEYS = {
                    openai: "demo",
                    deepseek: "demo", 
                    gemini: "demo"
                };
                return false;
            }
        }
        
        // ========== CONFIGURATION ==========
        const CORS_PROXIES = [
            'https://api.allorigins.win/raw?url=',
            'https://thingproxy.freeboard.io/fetch/',
            'https://corsproxy.io/?'
        ];
        
        let currentProxyIndex = 0;
        let isAdmin = false;
        let isLoggedIn = false;
        let selectedAI = 'auto';
        let isProcessing = false;
        let apiMode = 'demo'; // Start in demo mode until API keys are verified
        let currentUserEmail = '';
        
        // ========== DOM ELEMENTS ==========
        const chatMessages = document.getElementById('chatMessages');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const aiButtons = document.querySelectorAll('.ai-btn');
        const aiName = document.querySelector('.ai-name');
        const aiDescription = document.querySelector('.ai-description');
        const aiIcon = document.querySelector('.ai-icon');
        const statusIndicator = document.getElementById('statusIndicator');
        const statusText = document.getElementById('statusText');
        const apiModeIndicator = document.getElementById('apiMode');
        const apiStatusText = document.getElementById('apiStatusText');
        const apiConfigModal = document.getElementById('apiConfigModal');
        const openApiConfigBtn = document.getElementById('openApiConfig');
        const closeModalBtn = document.getElementById('closeModal');
        const quickLoginBtn = document.getElementById('quickLogin');
        const siteTitle = document.getElementById('siteTitle');
        
        // Login elements
        const loginModal = document.getElementById('loginModal');
        const loginEmail = document.getElementById('loginEmail');
        const loginPassword = document.getElementById('loginPassword');
        const loginBtn = document.getElementById('loginBtn');
        const loginError = document.getElementById('loginError');
        const rememberMeCheckbox = document.getElementById('rememberMe');
        
        // API Status elements
        const openaiStatus = document.getElementById('openaiStatus');
        const deepseekStatus = document.getElementById('deepseekStatus');
        const geminiStatus = document.getElementById('geminiStatus');
        
        // ========== INITIALIZATION ==========
        document.addEventListener('DOMContentLoaded', () => {
            // First decode API keys
            const keysDecoded = decodeAPIKeys();
            
            setupEventListeners();
            
            // Auto-resize textarea
            userInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
            
            // Check if already logged in
            checkExistingLogin();
            
            // Pre-fill remember me if previously checked
            const rememberMe = getRememberMePreference();
            if (rememberMeCheckbox) {
                rememberMeCheckbox.checked = rememberMe;
            }
            
            // Check API keys configuration
            if (keysDecoded) {
                setTimeout(checkApiKeysConfiguration, 1000);
            }
        });
        
        // ========== USER-SPECIFIC STORAGE ==========
        function getUserStorageKey(key) {
            if (!currentUserEmail) return key;
            // Create a unique key for each user using their email
            const userHash = btoa(currentUserEmail).replace(/[^a-zA-Z0-9]/g, '_');
            return `multiAI_${userHash}_${key}`;
        }
        
        function getRememberMePreference() {
            // Global preference (not user-specific)
            return localStorage.getItem('multiAI_rememberMe') === 'true';
        }
        
        function saveUserLoginState(email, isAdminUser, rememberMe) {
            const userData = {
                email: email,
                isAdmin: isAdminUser,
                timestamp: new Date().getTime()
            };
            
            if (rememberMe) {
                // Long-term storage (30 days)
                const expiryDate = new Date();
                expiryDate.setDate(expiryDate.getDate() + REMEMBER_DAYS);
                userData.expiry = expiryDate.getTime();
                
                localStorage.setItem(getUserStorageKey('loginData'), JSON.stringify(userData));
                // Save global remember me preference
                localStorage.setItem('multiAI_rememberMe', 'true');
            } else {
                // Session-only storage (cleared when browser closes)
                sessionStorage.setItem(getUserStorageKey('loginData'), JSON.stringify(userData));
                localStorage.setItem('multiAI_rememberMe', 'false');
            }
        }
        
        function checkExistingLogin() {
            // Get all keys from localStorage and sessionStorage
            const allKeys = [...Object.keys(localStorage), ...Object.keys(sessionStorage)];
            
            // Find login data for any user
            for (const key of allKeys) {
                if (key.includes('loginData')) {
                    try {
                        const storage = key.startsWith('multiAI_') ? localStorage : sessionStorage;
                        const data = JSON.parse(storage.getItem(key));
                        
                        // Check if login has expired
                        if (data.expiry && data.expiry < new Date().getTime()) {
                            // Clear expired login
                            storage.removeItem(key);
                            continue;
                        }
                        
                        // Auto-login with this user
                        currentUserEmail = data.email;
                        isLoggedIn = true;
                        isAdmin = data.isAdmin || false;
                        loginModal.classList.remove('active');
                        updateUIForLoggedInUser(isAdmin);
                        updateApiStatus();
                        
                        showNotification(isAdmin ? 
                            'Welcome back Admin!' : 
                            `Welcome back ${data.email}!`, 'info');
                        
                        return;
                    } catch (e) {
                        console.error('Error parsing login data:', e);
                    }
                }
            }
        }
        
        function clearUserData() {
            if (!currentUserEmail) return;
            
            // Clear user-specific data
            const userHash = btoa(currentUserEmail).replace(/[^a-zA-Z0-9]/g, '_');
            const prefix = `multiAI_${userHash}_`;
            
            // Remove all user-specific keys
            Object.keys(localStorage).forEach(key => {
                if (key.startsWith(prefix)) {
                    localStorage.removeItem(key);
                }
            });
            
            Object.keys(sessionStorage).forEach(key => {
                if (key.startsWith(prefix)) {
                    sessionStorage.removeItem(key);
                }
            });
        }
        
        // ========== API KEY CONFIGURATION CHECK ==========
        async function checkApiKeysConfiguration() {
            // Check if API keys are demo or empty
            const hasDemoKeys = ADMIN_API_KEYS.openai === "demo" || 
                               ADMIN_API_KEYS.deepseek === "demo" || 
                               ADMIN_API_KEYS.gemini === "demo";
            
            if (hasDemoKeys) {
                apiMode = 'demo';
                updateApiStatusUI('All APIs', 'Demo mode - Add your keys', 'invalid');
                console.log('Running in demo mode. Add your API keys.');
                return;
            }
            
            // Test each API key
            await testOpenAIKey();
            await testDeepSeekKey();
            await testGeminiKey();
            
            // Check if at least one API key is working
            const openaiValid = !openaiStatus.classList.contains('invalid');
            const deepseekValid = !deepseekStatus.classList.contains('invalid');
            const geminiValid = !geminiStatus.classList.contains('invalid');
            
            if (openaiValid || deepseekValid || geminiValid) {
                apiMode = 'real';
                console.log('Real API mode enabled. At least one API key is working.');
            } else {
                apiMode = 'demo';
                console.log('No valid API keys found. Running in demo mode.');
            }
        }
        
        async function testOpenAIKey() {
            const key = ADMIN_API_KEYS.openai;
            if (!key || key === "demo") {
                updateApiStatusUI('OpenAI', 'Not configured', 'invalid');
                return;
            }
            
            try {
                // Simple test - list models endpoint
                const response = await fetchWithFallback('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    updateApiStatusUI('OpenAI', 'Valid', 'valid');
                } else {
                    updateApiStatusUI('OpenAI', `Error: ${response.status}`, 'invalid');
                }
            } catch (error) {
                console.error('OpenAI test failed:', error);
                updateApiStatusUI('OpenAI', 'Connection failed', 'invalid');
            }
        }
        
        async function testDeepSeekKey() {
            const key = ADMIN_API_KEYS.deepseek;
            if (!key || key === "demo") {
                updateApiStatusUI('DeepSeek', 'Not configured', 'invalid');
                return;
            }
            
            try {
                // Test with a simple completion
                const response = await fetchWithFallback('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${key}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{ role: 'user', content: 'test' }],
                        max_tokens: 1
                    })
                });
                
                if (response.status === 200 || response.status === 401) {
                    // 401 means key is valid but might need different endpoint
                    updateApiStatusUI('DeepSeek', 'Valid', 'valid');
                } else {
                    updateApiStatusUI('DeepSeek', `Error: ${response.status}`, 'invalid');
                }
            } catch (error) {
                console.error('DeepSeek test failed:', error);
                updateApiStatusUI('DeepSeek', 'Connection failed', 'invalid');
            }
        }
        
        async function testGeminiKey() {
            const key = ADMIN_API_KEYS.gemini;
            if (!key || key === "demo") {
                updateApiStatusUI('Gemini', 'Not configured', 'invalid');
                return;
            }
            
            try {
                // Test with models list
                const response = await fetchWithFallback(`https://generativelanguage.googleapis.com/v1beta/models?key=${key}`);
                
                if (response.ok) {
                    updateApiStatusUI('Gemini', 'Valid', 'valid');
                } else {
                    updateApiStatusUI('Gemini', `Error: ${response.status}`, 'invalid');
                }
            } catch (error) {
                console.error('Gemini test failed:', error);
                updateApiStatusUI('Gemini', 'Connection failed', 'invalid');
            }
        }
        
        function updateApiStatusUI(apiName, message, status) {
            let element;
            switch(apiName) {
                case 'OpenAI': element = openaiStatus; break;
                case 'DeepSeek': element = deepseekStatus; break;
                case 'Gemini': element = geminiStatus; break;
                default: return;
            }
            
            element.innerHTML = status === 'valid' 
                ? `<i class="fas fa-check-circle"></i> ${message}`
                : `<i class="fas fa-times-circle"></i> ${message}`;
            element.className = `key-status ${status}`;
        }
        
        async function fetchWithFallback(url, options = {}) {
            try {
                // Try direct fetch first
                const response = await fetch(url, options);
                return response;
            } catch (error) {
                console.log('Direct fetch failed, trying CORS proxy...');
                
                // Try with CORS proxy
                const proxyUrl = CORS_PROXIES[currentProxyIndex] + encodeURIComponent(url);
                const proxyOptions = {
                    ...options,
                    headers: {
                        ...options.headers,
                        'Content-Type': 'application/json'
                    }
                };
                
                try {
                    const response = await fetch(proxyUrl, proxyOptions);
                    if (!response.ok) {
                        // Try next proxy
                        currentProxyIndex = (currentProxyIndex + 1) % CORS_PROXIES.length;
                        throw new Error('Proxy failed');
                    }
                    return response;
                } catch (proxyError) {
                    console.error('All fetch attempts failed:', proxyError);
                    throw error;
                }
            }
        }
        
        function setupEventListeners() {
            // Send message
            sendBtn.addEventListener('click', sendMessage);
            userInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            // AI selection
            aiButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (!isLoggedIn) {
                        showNotification('Please login first', 'error');
                        loginModal.classList.add('active');
                        return;
                    }
                    aiButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    selectedAI = this.dataset.ai;
                    updateAIInfo(selectedAI);
                });
            });
            
            // Login
            loginBtn.addEventListener('click', handleLogin);
            loginPassword.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    handleLogin();
                }
            });
            
            // Quick login button
            quickLoginBtn.addEventListener('click', () => {
                loginModal.classList.add('active');
            });
            
            // Remember me checkbox
            if (rememberMeCheckbox) {
                rememberMeCheckbox.addEventListener('change', function() {
                    localStorage.setItem('multiAI_rememberMe', this.checked);
                });
            }
            
            // API Config modal (only for admin)
            if (openApiConfigBtn) {
                openApiConfigBtn.addEventListener('click', () => {
                    if (isAdmin) {
                        apiConfigModal.classList.add('active');
                    }
                });
            }
            
            if (closeModalBtn) {
                closeModalBtn.addEventListener('click', () => apiConfigModal.classList.remove('active'));
            }
            
            // Close modal on outside click
            if (apiConfigModal) {
                apiConfigModal.addEventListener('click', (e) => {
                    if (e.target === apiConfigModal) {
                        apiConfigModal.classList.remove('active');
                    }
                });
            }
            
            if (loginModal) {
                loginModal.addEventListener('click', (e) => {
                    if (e.target === loginModal && isLoggedIn) {
                        loginModal.classList.remove('active');
                    }
                });
            }
        }
        
        // ========== LOGIN HANDLING ==========
        function handleLogin() {
            const email = loginEmail.value.trim();
            const password = loginPassword.value.trim();
            const rememberMe = rememberMeCheckbox ? rememberMeCheckbox.checked : false;
            
            if (!email || !password) {
                loginError.textContent = 'Please enter both email and password';
                loginError.style.display = 'block';
                return;
            }
            
            // For public users - any email/password works (except admin credentials)
            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                // Admin login
                handleSuccessfulLogin(email, true, rememberMe);
                
            } else if (email && password) {
                // Public user login (any credentials work)
                handleSuccessfulLogin(email, false, rememberMe);
                
            } else {
                // Invalid credentials
                loginError.textContent = 'Invalid email or password';
                loginError.style.display = 'block';
                loginEmail.style.borderColor = '#ef4444';
                loginPassword.style.borderColor = '#ef4444';
            }
        }
        
        function handleSuccessfulLogin(email, isAdminUser, rememberMe) {
            currentUserEmail = email;
            isAdmin = isAdminUser;
            isLoggedIn = true;
            loginError.style.display = 'none';
            loginModal.classList.remove('active');
            
            // Save user-specific login state
            saveUserLoginState(email, isAdminUser, rememberMe);
            
            // Update UI
            updateUIForLoggedInUser(isAdminUser);
            updateApiStatus();
            
            showNotification(isAdminUser ? 
                'Admin logged in successfully!' : 
                `Welcome ${email}!`, 'info');
        }
        
        // ========== LOGOUT FUNCTIONALITY ==========
        function addLogoutButton() {
            // Check if logout button already exists
            if (document.getElementById('logoutBtn')) return;
            
            const logoutBtn = document.createElement('button');
            logoutBtn.id = 'logoutBtn';
            logoutBtn.className = 'api-config-btn';
            logoutBtn.innerHTML = '<i class="fas fa-sign-out-alt"></i> Logout';
            logoutBtn.style.marginLeft = '10px';
            
            logoutBtn.addEventListener('click', handleLogout);
            
            // Insert after API config button
            const headerActions = document.querySelector('.header-content > div:last-child');
            if (headerActions) {
                headerActions.appendChild(logoutBtn);
            }
        }
        
        function handleLogout() {
            // Clear user-specific data
            clearUserData();
            
            // Reset state
            isLoggedIn = false;
            isAdmin = false;
            currentUserEmail = '';
            
            // Update UI
            userInput.disabled = true;
            userInput.placeholder = "Please login to use the AI assistant...";
            sendBtn.disabled = true;
            
            siteTitle.textContent = 'Multi-AI Assistant';
            if (openApiConfigBtn) {
                openApiConfigBtn.style.display = 'none';
            }
            
            // Remove logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) logoutBtn.remove();
            
            // Reset AI selector
            aiButtons.forEach(btn => btn.classList.remove('active'));
            const autoBtn = document.querySelector('.ai-btn[data-ai="auto"]');
            if (autoBtn) autoBtn.classList.add('active');
            selectedAI = 'auto';
            
            // Update status
            statusText.textContent = 'Not Logged In';
            statusIndicator.querySelector('i').style.color = '#ef4444';
            apiStatusText.textContent = 'Please login to use the assistant';
            apiModeIndicator.innerHTML = '<i class="fas fa-plug"></i> Login Required';
            apiModeIndicator.className = 'api-mode-indicator inactive';
            aiDescription.textContent = 'Login to access real AI capabilities';
            aiIcon.className = 'ai-icon chatgpt-icon';
            aiIcon.innerHTML = '<i class="fas fa-magic"></i>';
            aiName.textContent = 'Auto AI Selector';
            
            // Show logout message
            addMessage('You have been logged out. Please login again to use the AI assistant.', 'ai', 'system');
            showNotification('Logged out successfully', 'info');
            
            // Show login modal
            loginModal.classList.add('active');
        }
        
        function updateUIForLoggedInUser(isAdminUser) {
            // Enable input and send button
            userInput.disabled = false;
            userInput.placeholder = "Type your message here... (Press Shift+Enter for new line)";
            sendBtn.disabled = false;
            
            // Update status
            statusText.textContent = 'Ready';
            statusIndicator.querySelector('i').style.color = '#10a37f';
            
            // Add logout button
            addLogoutButton();
            
            if (isAdminUser) {
                // Admin UI
                siteTitle.textContent = 'Multi-AI Assistant (Admin)';
                if (openApiConfigBtn) {
                    openApiConfigBtn.style.display = 'block';
                }
                apiModeIndicator.innerHTML = '<i class="fas fa-user-shield"></i> Admin Mode';
                apiModeIndicator.className = 'api-mode-indicator active';
                aiDescription.textContent = 'Admin mode - All AI services available';
            } else {
                // Public user UI
                siteTitle.textContent = 'Multi-AI Assistant';
                if (openApiConfigBtn) {
                    openApiConfigBtn.style.display = 'none';
                }
                apiModeIndicator.innerHTML = '<i class="fas fa-plug"></i> Public Mode';
                apiModeIndicator.className = 'api-mode-indicator active';
                aiDescription.textContent = 'Public access - Shared AI services';
            }
            
            // Update API status
            updateApiStatus();
            
            // Add welcome message to chat
            const rememberMe = rememberMeCheckbox ? rememberMeCheckbox.checked : false;
            const apiModeText = apiMode === 'demo' ? ' (Demo Mode)' : ' (Real AI Mode)';
            const welcomeMsg = isAdminUser 
                ? `Welcome Admin! You have full access to all AI services.${apiModeText} ${rememberMe ? '(Remembered for 30 days)' : ''}`
                : `Welcome! You can now use the AI assistant with shared access.${apiModeText} ${rememberMe ? '(Remembered for 30 days)' : ''}`;
            
            addMessage(welcomeMsg, 'ai', 'system');
        }
        
        function updateApiStatus() {
            if (apiMode === 'real') {
                apiStatusText.textContent = isAdmin 
                    ? 'Admin Mode - Real API Access' 
                    : 'Public Mode - Real AI Access';
            } else {
                apiStatusText.textContent = isAdmin 
                    ? 'Admin Mode - Demo API (Configure keys for real access)' 
                    : 'Public Mode - Demo AI Responses';
            }
        }
        
        // ========== AI SELECTION LOGIC ==========
        function determineAI(query) {
            if (selectedAI !== 'auto') {
                return selectedAI;
            }
            
            const lowerQuery = query.toLowerCase();
            
            // Priority 1: Coding/Math → DeepSeek
            const codingPatterns = [
                /code|program|function|algorithm|debug|javascript|python|html|css|java|c\+\+|react|vue|angular|node|express|sql|database|api|git|terminal|command|syntax|error|bug|fix/i,
                /implement|function|class|object|array|loop|variable|const|let|var|return|async|await|promise|callback|module|import|export/i,
                /\bfor\s+loop|\bwhile\s+loop|\bif\s+statement|\bswitch\s+case|\btry\s+catch/i
            ];
            
            const mathPatterns = [
                /math|calculate|equation|formula|statistic|probability|algebra|calculus|integral|derivative/i,
                /solve.*problem|graph|function|geometry|trigonometry|matrix|vector|linear|quadratic/i,
                /\b(\d+[\s\+\-\*\/\^]\d+|\b(sin|cos|tan|log|ln|sqrt)\b)/i
            ];
            
            if (codingPatterns.some(p => p.test(lowerQuery)) || mathPatterns.some(p => p.test(lowerQuery))) {
                return 'deepseek';
            }
            
            // Priority 2: Images/Visual → Gemini
            const imagePatterns = [
                /image|picture|photo|visual|draw|generate.*image|describe.*image|analyze.*image/i,
                /what.*(see|shown).*(image|picture)|vision|look.*like|appearance|design|art/i,
                /color|shape|size|dimension|pixel|resolution|jpg|png|gif|svg|drawing|painting/i
            ];
            
            if (imagePatterns.some(p => p.test(lowerQuery))) {
                return 'gemini';
            }
            
            // Priority 3: Writing/Creative → ChatGPT
            const writingPatterns = [
                /write|essay|story|poem|creative|article|blog|email|letter|content|brainstorm/i,
                /paraphrase|rewrite|translate|summary|outline|draft|edit|proofread|grammar/i,
                /plot|character|dialogue|introduction|conclusion|thesis|argument|persuade|creative/i
            ];
            
            if (writingPatterns.some(p => p.test(lowerQuery))) {
                return 'chatgpt';
            }
            
            // Default to ChatGPT
            return 'chatgpt';
        }
        
        function updateAIInfo(ai) {
            switch(ai) {
                case 'chatgpt':
                    aiName.textContent = 'ChatGPT';
                    aiDescription.textContent = isAdmin ? 'Admin: Full access' : 'Public: Shared access';
                    aiIcon.className = 'ai-icon chatgpt-icon';
                    aiIcon.innerHTML = '<i class="fas fa-comment"></i>';
                    break;
                case 'deepseek':
                    aiName.textContent = 'DeepSeek';
                    aiDescription.textContent = isAdmin ? 'Admin: Full access' : 'Public: Shared access';
                    aiIcon.className = 'ai-icon deepseek-icon';
                    aiIcon.innerHTML = '<i class="fas fa-code"></i>';
                    break;
                case 'gemini':
                    aiName.textContent = 'Gemini';
                    aiDescription.textContent = isAdmin ? 'Admin: Full access' : 'Public: Shared access';
                    aiIcon.className = 'ai-icon gemini-icon';
                    aiIcon.innerHTML = '<i class="fas fa-image"></i>';
                    break;
                default:
                    aiName.textContent = 'Auto AI Selector';
                    aiDescription.textContent = isAdmin ? 'Admin: All AI available' : 'Public: Shared AI access';
                    aiIcon.className = 'ai-icon chatgpt-icon';
                    aiIcon.innerHTML = '<i class="fas fa-magic"></i>';
                    break;
            }
        }
        
        // ========== MESSAGE HANDLING ==========
        async function sendMessage() {
            if (!isLoggedIn) {
                showNotification('Please login first', 'error');
                loginModal.classList.add('active');
                return;
            }
            
            const message = userInput.value.trim();
            if (!message || isProcessing) return;
            
            // Add user message
            addMessage(message, 'user');
            
            // Clear input
            userInput.value = '';
            userInput.style.height = 'auto';
            
            // Determine AI
            const aiToUse = determineAI(message);
            
            // Show typing
            showTypingIndicator(aiToUse);
            
            // Set state
            isProcessing = true;
            sendBtn.disabled = true;
            updateStatus('processing', `Processing with ${aiToUse}...`);
            
            try {
                let response;
                if (apiMode === 'real' && isLoggedIn) {
                    try {
                        // Use admin's API keys for all users
                        response = await callRealAPI(message, aiToUse);
                        showNotification(`${aiToUse} response received`, 'info');
                    } catch (apiError) {
                        console.error('API Error:', apiError);
                        // Fall back to demo mode if API fails
                        response = generateDemoResponse(message, aiToUse);
                        showNotification('API failed. Using demo responses.', 'info');
                    }
                } else {
                    // Use demo mode
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    response = generateDemoResponse(message, aiToUse);
                    if (apiMode === 'demo') {
                        showNotification('Demo response (Add your API keys)', 'info');
                    }
                }
                
                removeTypingIndicator();
                addMessage(response, 'ai', aiToUse);
                updateStatus('ready', 'Ready');
                
            } catch (error) {
                console.error('General Error:', error);
                removeTypingIndicator();
                // More user-friendly error message
                const errorMsg = `I encountered an issue while processing your request. ${
                    apiMode === 'real' 
                    ? 'The AI service might be temporarily unavailable. Please try again in a moment.' 
                    : 'Please check your API configuration or try again later.'
                }`;
                addMessage(errorMsg, 'ai', aiToUse);
                updateStatus('error', 'Processing Error');
                showNotification('Failed to get response. Please try again.', 'error');
                
            } finally {
                isProcessing = false;
                sendBtn.disabled = false;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
        }
        
        // ========== REAL API CALLS ==========
        async function callRealAPI(message, aiType) {
            // Check if API keys are demo
            if (ADMIN_API_KEYS.openai === "demo" || 
                ADMIN_API_KEYS.deepseek === "demo" || 
                ADMIN_API_KEYS.gemini === "demo") {
                throw new Error('API keys not configured. Running in demo mode.');
            }
            
            let url, headers, body;
            
            // Use admin's API keys for all logged-in users
            switch(aiType) {
                case 'chatgpt':
                    if (!ADMIN_API_KEYS.openai || ADMIN_API_KEYS.openai === "demo") {
                        throw new Error('OpenAI API key not configured');
                    }
                    url = 'https://api.openai.com/v1/chat/completions';
                    headers = {
                        'Authorization': `Bearer ${ADMIN_API_KEYS.openai}`,
                        'Content-Type': 'application/json'
                    };
                    body = JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [{ role: 'user', content: message }],
                        max_tokens: 1000,
                        temperature: 0.7
                    });
                    break;
                    
                case 'deepseek':
                    if (!ADMIN_API_KEYS.deepseek || ADMIN_API_KEYS.deepseek === "demo") {
                        throw new Error('DeepSeek API key not configured');
                    }
                    url = 'https://api.deepseek.com/chat/completions';
                    headers = {
                        'Authorization': `Bearer ${ADMIN_API_KEYS.deepseek}`,
                        'Content-Type': 'application/json'
                    };
                    body = JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [{ role: 'user', content: message }],
                        max_tokens: 1000,
                        temperature: 0.7
                    });
                    break;
                    
                case 'gemini':
                    if (!ADMIN_API_KEYS.gemini || ADMIN_API_KEYS.gemini === "demo") {
                        throw new Error('Gemini API key not configured');
                    }
                    url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key=${ADMIN_API_KEYS.gemini}`;
                    headers = { 'Content-Type': 'application/json' };
                    body = JSON.stringify({
                        contents: [{
                            parts: [{ text: message }]
                        }],
                        generationConfig: {
                            maxOutputTokens: 1000,
                            temperature: 0.7
                        }
                    });
                    break;
            }
            
            try {
                const response = await fetchWithFallback(url, {
                    method: 'POST',
                    headers,
                    body
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    throw new Error(`API Error: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Parse response based on AI type
                if (aiType === 'gemini') {
                    if (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts[0]) {
                        return data.candidates[0].content.parts[0].text;
                    } else {
                        throw new Error('Invalid Gemini API response format');
                    }
                } else {
                    if (data.choices && data.choices[0] && data.choices[0].message) {
                        return data.choices[0].message.content;
                    } else {
                        throw new Error('Invalid API response format');
                    }
                }
                
            } catch (error) {
                console.error(`API call failed for ${aiType}:`, error);
                throw error;
            }
        }
        
        // ========== UI HELPERS ==========
        function addMessage(text, sender, aiUsed = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            
            let avatarIcon = sender === 'user' 
                ? '<i class="fas fa-user"></i>' 
                : aiUsed === 'deepseek' 
                    ? '<i class="fas fa-code"></i>'
                    : aiUsed === 'gemini'
                        ? '<i class="fas fa-image"></i>'
                        : '<i class="fas fa-robot"></i>';
            
            let avatarClass = sender === 'user' ? 'user-avatar' : 'ai-avatar';
            
            messageDiv.innerHTML = `
                <div class="avatar ${avatarClass}">
                    ${avatarIcon}
                </div>
                <div class="message-content">
                    <div class="message-text">${formatMessage(text)}</div>
                    <div class="message-time">${time} ${aiUsed && sender === 'ai' ? `• ${aiUsed.toUpperCase()}` : ''}</div>
                </div>
            `;
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function formatMessage(text) {
            // Convert markdown-style code blocks
            let formattedText = text
                .replace(/```(\w+)?\n([\s\S]*?)```/g, 
                    '<pre><code class="language-$1">$2</code></pre>')
                .replace(/`([^`]+)`/g, 
                    '<code>$1</code>')
                .replace(/\n/g, '<br>');
            
            // Convert URLs to links
            formattedText = formattedText.replace(
                /(https?:\/\/[^\s<]+[^\s<.,:;!?)])/g, 
                '<a href="$1" target="_blank" rel="noopener">$1</a>'
            );
            
            return formattedText;
        }
        
        function showTypingIndicator(ai) {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message';
            typingDiv.id = 'typingIndicator';
            
            let avatarIcon = ai === 'deepseek' 
                ? '<i class="fas fa-code"></i>'
                : ai === 'gemini'
                    ? '<i class="fas fa-image"></i>'
                    : '<i class="fas fa-robot"></i>';
            
            typingDiv.innerHTML = `
                <div class="avatar ai-avatar">
                    ${avatarIcon}
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function removeTypingIndicator() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        function updateStatus(status, text) {
            const icon = statusIndicator.querySelector('i');
            statusText.textContent = text;
            
            switch(status) {
                case 'processing':
                    icon.style.color = '#f59e0b';
                    break;
                case 'ready':
                    icon.style.color = '#10a37f';
                    break;
                case 'error':
                    icon.style.color = '#ef4444';
                    break;
            }
        }
        
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            const notification = document.createElement('div');
            notification.className = `notification ${type === 'error' ? 'error' : ''}`;
            notification.innerHTML = `
                <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Auto-remove after 3 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // ========== DEMO MODE ==========
        function generateDemoResponse(query, ai) {
            // More realistic demo responses
            const responses = {
                chatgpt: [
                    `Here's a ChatGPT-style response to: "${query}"\n\nAs ChatGPT, I would analyze this question carefully. It seems you're asking about a topic that requires nuanced understanding. In a real response, I would:\n1. Break down the key concepts\n2. Provide relevant examples\n3. Offer practical applications\n4. Suggest additional resources if needed\n\nFor this specific query, I would focus on delivering clear, well-structured information that addresses your core concerns while maintaining accuracy and helpfulness.`,
                    `Based on your question about "${query.substring(0, 40)}...", here's how ChatGPT would respond:\n\nI understand you're looking for information on this topic. Let me provide you with a comprehensive overview:\n\n• First, I'd establish the context and key definitions\n• Then, I'd explore the main aspects of the topic\n• Next, I'd provide practical examples or case studies\n• Finally, I'd offer actionable advice or next steps\n\nThis structured approach ensures you get both breadth and depth in the response.`,
                    `Your question "${query.substring(0, 50)}..." appears to involve analytical thinking. ChatGPT excels at this type of inquiry by:\n\n1. Identifying underlying assumptions\n2. Examining multiple perspectives\n3. Synthesizing information from various angles\n4. Presenting balanced conclusions\n\nIn a full response, you'd receive detailed explanations with supporting evidence and clear reasoning at each step.`
                ],
                deepseek: [
                    `As DeepSeek, I'd approach "${query}" with a technical focus. Here's what a real response would include:\n\n\`\`\`javascript
// Example code structure for this type of problem
function analyzeQuery(input) {
    // Parse and process the query
    const tokens = input.split(' ');
    const analysis = tokens.map(token => {
        return {
            token,
            length: token.length,
            type: classifyToken(token)
        };
    });
    
    // Return structured analysis
    return {
        query: input,
        analysis: analysis,
        suggestions: generateSuggestions(analysis)
    };
}
\`\`\`\n\nFor technical queries, DeepSeek provides code examples, algorithm explanations, and step-by-step debugging guidance.`,
                    `Technical analysis of: "${query.substring(0, 40)}..."\n\n**Problem Breakdown:**\n1. Identify core technical requirements\n2. Analyze potential solutions\n3. Consider edge cases and optimization\n4. Provide implementation guidance\n\n**Example Approach:**\n\`\`\`python
def solve_problem(query):
    # Parse technical requirements
    requirements = extract_requirements(query)
    
    # Design algorithm
    algorithm = design_algorithm(requirements)
    
    # Implement with error handling
    try:
        result = execute_algorithm(algorithm)
        return optimize_result(result)
    except Exception as e:
        return handle_error(e, algorithm)
\`\`\`\n\nDeepSeek specializes in practical, implementable solutions.`,
                    `For "${query.substring(0, 30)}...", DeepSeek would provide:\n\n**Technical Analysis:**\n- Algorithm complexity considerations\n- Memory and performance implications\n- Best practices and patterns\n- Testing and validation strategies\n\n**Code Example:**\n\`\`\`
// Pseudo-code for solution architecture
interface Solution {
    design: Architecture;
    implement: (spec: Spec) => Code;
    test: (input: TestCase[]) => Results;
    optimize: (metrics: Metrics) => ImprovedSolution;
}
\`\`\`\n\nExpect detailed technical explanations with working code snippets.`
            ],
            gemini: [
                `As Gemini, I'd analyze "${query}" with visual and multimodal capabilities. Here's how I'd approach it:\n\n**Visual Analysis Framework:**\n1. Image/Pattern Recognition\n2. Contextual Understanding\n3. Multimodal Integration\n4. Creative Generation\n\n**For this query, I would:**\n• Identify visual elements if images were provided\n• Analyze spatial relationships and patterns\n• Provide descriptive interpretations\n• Suggest visual enhancements or alternatives\n\nGemini excels at combining visual understanding with textual analysis.`,
                `Multimodal response to: "${query.substring(0, 40)}..."\n\n**If this involves images, I would:**\n1. Detect objects, scenes, and text in images\n2. Analyze colors, compositions, and visual styles\n3. Provide descriptive captions and interpretations\n4. Suggest related visual concepts or modifications\n\n**Example visual analysis structure:**\n- **Primary Subjects:** [Identified objects/people]\n- **Visual Style:** [Artistic characteristics]\n- **Color Palette:** [Dominant colors and tones]\n- **Composition:** [Layout and spatial arrangement]\n- **Context:** [Cultural or situational interpretation]`,
                `Your query "${query.substring(0, 30)}..." suggests visual/multimodal interest. Gemini's response would include:\n\n**Image Understanding Components:**\n• Object detection and classification\n• Scene understanding and context\n• Text extraction from images (OCR)\n• Visual similarity and pattern matching\n\n**Creative Capabilities:**\n• Image description and alt-text generation\n• Visual concept explanation\n• Multimodal content suggestions\n• Cross-modal connections between text and images\n\nGemini bridges visual and textual domains effectively.`
            ]
        };
        
        const aiResponses = responses[ai] || responses.chatgpt;
        const randomIndex = Math.floor(Math.random() * aiResponses.length);
        
        return aiResponses[randomIndex];
    }
</script>
</body>
</html>
